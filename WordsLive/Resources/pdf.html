<!doctype html>
<html>

<head>
	<title>PDF</title>
	<script type="text/javascript" src="asset://WordsLive.Core/thirdparty/pdf.js"></script>
	<script type="text/javascript" src="asset://WordsLive.Core/thirdparty/jquery.js"></script>
	<script type="text/javascript" src="asset://WordsLive.Core/thirdparty/jquery.mousewheel.js"></script>
  
	<style>
		body { margin: 0; overflow: hidden; background-color: black;}
		#viewer { display: flex; justify-content: center; align-items: center; height: 100vh; }
		.pdfpage { margin: auto; }
	</style>

	<script type="text/javascript">
		'use strict';

		function renderPage(div, pdf, pageNumber, wholePage) {
			pdf.getPage(pageNumber).then(function(page) {
				var unscaledViewport = page.getViewport(1);
				var scale;
				if (wholePage) {
					scale = Math.min(
						$(document).width() / unscaledViewport.width,
						$(document).height() / unscaledViewport.height
					);
				} else {
					scale = $(document).width() / unscaledViewport.width;
				}
				var viewport = page.getViewport(scale);

				var pageDisplayWidth = viewport.width;
				var pageDisplayHeight = viewport.height;

				var pageDivHolder = document.createElement('div');
				pageDivHolder.className = 'pdfpage';
				$(pageDivHolder).attr('id', 'page_'+pageNumber);
				pageDivHolder.style.width = pageDisplayWidth + 'px';
				pageDivHolder.style.height = pageDisplayHeight + 'px';
				div.appendChild(pageDivHolder);

				// Prepare canvas using PDF page dimensions
				var canvas = document.createElement('canvas');
				var context = canvas.getContext('2d');
				canvas.width = pageDisplayWidth;
				canvas.height = pageDisplayHeight;
				pageDivHolder.appendChild(canvas);


				// Render PDF page into canvas context
				var renderContext = {
					canvasContext: context,
					viewport: viewport
				};
				page.render(renderContext);

				// Prepare and populate form elements layer
				var formDiv = document.createElement('div');
				pageDivHolder.appendChild(formDiv);
			});
		}

		var doc;
		var currentPage = 1;
		var isWholePage = false;

		function renderCurrentPage() {
			var viewer = document.getElementById('viewer');
			$(viewer).empty();
			renderPage(viewer, doc, currentPage, isWholePage);
		}

		(async function () {
		    await CefSharp.BindObjectAsync("bridge");
		
			// Fetch the PDF document from the URL using promices
		    PDFJS.getDocument(await bridge.getDocument()).then(async function getPdfForm(pdf) {
			    doc = pdf;
				await bridge.onCallbackLoaded();
				renderCurrentPage();
			});
		})();

		$(window).resize(function () {
			renderCurrentPage();
		});

		$(function () {
			$('#viewer').bind("mousewheel", function (ev, delta) {
				var scrollTop = $(window).scrollTop();
				$(window).scrollTop(scrollTop - Math.round(delta*50));
			});
		});

		function wholePage() {
			if (!isWholePage) {
				isWholePage = true;
				renderCurrentPage();
			}
		}

		function fitToWidth() {
			if (isWholePage) {
				isWholePage = false;
				renderCurrentPage();
			}
		}

		function gotoPage(p) {
			p = Math.max(1, Math.min(p, getPageCount()));
			if (currentPage === p) {
				return;
			}
			currentPage = p;
			renderCurrentPage();
		}
	  
		function getCurrentPage() {
			return currentPage;
		}
		
		function getPageCount() {
			return doc.numPages;
		}
	  
		function nextPage() {
			gotoPage(getCurrentPage() + 1);
		}
	  
		function prevPage() {
			gotoPage(getCurrentPage() - 1);
		}
	</script>
</head>

<body>
	<div id="viewer"></div>
</body>
</html>
